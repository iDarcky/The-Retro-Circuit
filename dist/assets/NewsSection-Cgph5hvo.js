import{j as e,B as d}from"./ui-utils-Bc8hcx-Q.js";import{r as s,L as I}from"./vendor-react-DYQUvfhN.js";import{a as K,b as Q,c as W,d as V}from"./index-B-i4yEhk.js";const J=({limit:T,showAddForm:w=!0,compact:o=!1})=>{const[y,O]=s.useState([]),[v,j]=s.useState(!1),[h,S]=s.useState(null),[i,c]=s.useState(1),[$,D]=s.useState(0),[l,H]=s.useState("ALL"),[E,M]=s.useState({consoles:[],games:[]}),g=o?T||3:10,[m,k]=s.useState(!1),[f,C]=s.useState(""),[p,R]=s.useState(""),[A,F]=s.useState("Hardware"),[G,L]=s.useState(!1),x=s.useCallback(async(r,n)=>{j(!0),S(null),o||window.scrollTo({top:0,behavior:"smooth"});try{const{data:a,count:t}=await K(r,g,n);O(a),D(t)}catch{S("NO CONNECTION TO MAINFRAME. CHECK SUPABASE CONFIG.")}finally{j(!1)}},[o,g]);s.useEffect(()=>{x(i,l)},[i,l,x]),s.useEffect(()=>{(async()=>{try{const[n,a]=await Promise.all([Q(),W()]);M({consoles:n,games:a})}catch{console.warn("Failed to load reference data for linking")}})()},[]);const b=r=>{H(r),c(1)},P=async r=>{if(r.preventDefault(),!f||!p)return;L(!0);const n={headline:f,summary:p,category:A,date:new Date().toISOString()};await V(n)?(C(""),R(""),k(!1),c(1),await x(1,l)):alert("TRANSMISSION FAILED: CHECK DATABASE PERMISSIONS (RLS)"),L(!1)},U=r=>{const n=r.toLowerCase(),a=[];return E.consoles.forEach(t=>{const N=t.name.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").toLowerCase();new RegExp(`\\b${N}\\b`,"i").test(n)&&a.push({type:"CONSOLE",label:t.name,to:`/consoles/${t.slug}`})}),E.games.forEach(t=>{const N=t.title.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").toLowerCase();new RegExp(`\\b${N}\\b`,"i").test(n)&&a.push({type:"GAME",label:t.title,to:`/games/${t.slug||t.id}`})}),a},u=Math.ceil($/g),B=r=>{switch(r){case"Hardware":return"text-retro-blue border-retro-blue hover:bg-retro-blue hover:text-retro-dark";case"Software":return"text-retro-pink border-retro-pink hover:bg-retro-pink hover:text-retro-dark";case"Industry":return"text-retro-neon border-retro-neon hover:bg-retro-neon hover:text-retro-dark";case"Rumor":return"text-yellow-400 border-yellow-400 hover:bg-yellow-400 hover:text-retro-dark";default:return"text-gray-400 border-gray-400 hover:bg-gray-400 hover:text-retro-dark"}},Y=r=>{switch(r){case"Hardware":return"bg-retro-blue text-retro-dark";case"Software":return"bg-retro-pink text-retro-dark";case"Industry":return"bg-retro-neon text-retro-dark";case"Rumor":return"bg-yellow-400 text-retro-dark";default:return"bg-gray-400 text-retro-dark"}};return e.jsxs("div",{className:`w-full ${o?"":"max-w-6xl mx-auto p-4"}`,children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-end mb-8 border-b-2 border-retro-grid pb-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:`${o?"text-xl":"text-3xl"} font-pixel text-retro-neon mb-2 drop-shadow-[2px_2px_0_rgba(255,0,255,0.5)]`,children:o?"LATEST SIGNALS":"CIRCUIT FEED"}),!o&&e.jsx("p",{className:"font-mono text-gray-400",children:"Latest signals from the golden age."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[w&&e.jsx(d,{onClick:()=>k(!m),variant:"secondary",className:"text-xs",children:m?"CLOSE":"BROADCAST"}),!o&&e.jsx(d,{onClick:()=>x(1,l),isLoading:v,variant:"primary",className:"text-xs",children:"REFRESH"}),o&&e.jsx(I,{to:"/news",children:e.jsx("button",{className:"font-mono text-xs text-retro-blue hover:text-retro-neon border border-retro-blue hover:border-retro-neon px-3 py-2 transition-colors uppercase",children:"View Archive"})})]})]}),!o&&e.jsxs("div",{className:"flex flex-wrap gap-3 mb-8",children:[e.jsx("button",{onClick:()=>b("ALL"),className:`font-mono text-xs px-4 py-1 border transition-all ${l==="ALL"?"bg-white text-retro-dark border-white font-bold":"text-gray-400 border-gray-600 hover:border-white hover:text-white"}`,children:"ALL SIGNALS"}),["Hardware","Software","Industry","Rumor"].map(r=>{const n=l===r,a=B(r);let t="";return n?r==="Hardware"?t="bg-retro-blue text-retro-dark border-retro-blue":r==="Software"?t="bg-retro-pink text-retro-dark border-retro-pink":r==="Industry"?t="bg-retro-neon text-retro-dark border-retro-neon":r==="Rumor"&&(t="bg-yellow-400 text-retro-dark border-yellow-400"):t=a,e.jsx("button",{onClick:()=>b(r),className:`font-mono text-xs px-4 py-1 border transition-all uppercase ${t}`,children:r},r)})]}),w&&m&&e.jsxs("div",{className:"mb-10 p-6 border-2 border-dashed border-retro-neon bg-retro-neon/5",children:[e.jsx("h3",{className:"font-pixel text-sm text-retro-neon mb-4",children:"INITIATING UPLINK SEQUENCE..."}),e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-mono text-xs text-retro-blue mb-1",children:"HEADLINE"}),e.jsx("input",{value:f,onChange:r=>C(r.target.value),className:"w-full bg-black/50 border border-retro-grid p-2 text-white font-mono focus:border-retro-neon outline-none",placeholder:"ENTER HEADLINE..."})]}),e.jsx("div",{className:"flex gap-4",children:e.jsxs("div",{className:"w-1/3",children:[e.jsx("label",{className:"block font-mono text-xs text-retro-blue mb-1",children:"CATEGORY"}),e.jsxs("select",{value:A,onChange:r=>F(r.target.value),className:"w-full bg-black/50 border border-retro-grid p-2 text-white font-mono focus:border-retro-neon outline-none",children:[e.jsx("option",{value:"Hardware",children:"HARDWARE"}),e.jsx("option",{value:"Software",children:"SOFTWARE"}),e.jsx("option",{value:"Industry",children:"INDUSTRY"}),e.jsx("option",{value:"Rumor",children:"RUMOR"})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-mono text-xs text-retro-blue mb-1",children:"SUMMARY"}),e.jsx("textarea",{value:p,onChange:r=>R(r.target.value),rows:3,className:"w-full bg-black/50 border border-retro-grid p-2 text-white font-mono focus:border-retro-neon outline-none",placeholder:"ENTER SIGNAL DATA..."})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(d,{type:"submit",isLoading:G,variant:"danger",children:"TRANSMIT DATA"})})]})]}),h&&e.jsxs("div",{className:"p-8 border-2 border-retro-pink text-retro-pink font-mono mb-6 bg-retro-pink/10 text-center",children:[e.jsxs("h3",{className:"text-xl font-bold mb-2",children:["ERROR: ",h]}),e.jsx("p",{className:"text-sm opacity-75",children:"Ensure your Supabase project is active and the 'news' table exists."})]}),v?e.jsx("div",{className:`grid grid-cols-1 ${o?"":"md:grid-cols-2"} gap-6`,children:[1,2].map(r=>e.jsxs("div",{className:"h-32 border border-retro-grid bg-retro-grid/20 animate-pulse rounded p-4",children:[e.jsx("div",{className:"h-4 bg-retro-grid/50 w-3/4 mb-4"}),e.jsx("div",{className:"h-24 bg-retro-grid/30 w-full"})]},r))}):y.length===0&&!h?e.jsxs("div",{className:"text-center py-12 border border-retro-grid border-dashed text-gray-500 font-mono",children:[e.jsx("div",{className:"mb-4",children:"NO SIGNAL FOUND FOR THIS FREQUENCY."}),l!=="ALL"&&e.jsx("button",{onClick:()=>b("ALL"),className:"text-retro-blue underline text-xs",children:"RESET FREQUENCY"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`grid grid-cols-1 ${o?"":"md:grid-cols-2"} gap-6`,children:y.map((r,n)=>{const a=U(`${r.headline} ${r.summary}`);return e.jsxs("article",{className:`group relative border-2 border-retro-grid bg-retro-dark hover:border-retro-neon transition-colors duration-300 ${o?"p-4":"p-6"} overflow-hidden flex flex-col h-full`,children:[e.jsx("div",{className:"absolute top-0 right-0 bg-retro-grid text-retro-neon text-xs font-mono px-2 py-1",children:new Date(r.date).toLocaleDateString()}),e.jsxs("div",{className:"mb-3",children:[e.jsx("button",{onClick:t=>{t.preventDefault(),o||b(r.category)},className:`inline-block px-2 py-0.5 text-[10px] font-bold font-mono mb-2 uppercase ${Y(r.category)} ${o?"cursor-default":"hover:opacity-80 cursor-pointer"}`,title:o?"":"Filter by this category",children:r.category}),e.jsx("h3",{className:`${o?"text-lg":"text-xl"} font-bold font-mono text-retro-blue group-hover:text-retro-neon transition-colors leading-tight`,children:r.headline})]}),e.jsx("p",{className:`text-gray-400 font-mono text-sm leading-relaxed border-l-2 border-retro-grid pl-4 flex-grow ${o?"line-clamp-3":""}`,children:r.summary}),a.length>0&&e.jsx("div",{className:"mt-4 flex flex-wrap gap-2",children:a.map(t=>e.jsxs(I,{to:t.to,className:`text-[10px] font-mono border px-2 py-0.5 transition-colors flex items-center gap-1
                                    ${t.type==="CONSOLE"?"border-retro-blue text-retro-blue hover:bg-retro-blue hover:text-black":"border-retro-pink text-retro-pink hover:bg-retro-pink hover:text-black"}`,children:[e.jsx("span",{className:"opacity-75",children:t.type==="CONSOLE"?"HARDWARE:":"GAME:"}),e.jsx("span",{className:"font-bold",children:t.label})]},t.to))}),e.jsx("div",{className:"absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-retro-pink via-retro-neon to-retro-blue opacity-0 group-hover:opacity-100 transition-opacity"})]},`${n}-${r.date}`)})}),!o&&u>1&&e.jsxs("div",{className:"flex justify-center items-center gap-4 py-8 border-t border-retro-grid/30 mt-8",children:[e.jsx(d,{variant:"secondary",onClick:()=>c(r=>Math.max(1,r-1)),disabled:i===1,children:"< PREV"}),e.jsxs("div",{className:"font-pixel text-xs text-retro-neon bg-retro-grid/20 px-4 py-2 rounded",children:["PAGE ",i," OF ",u]}),e.jsx(d,{variant:"secondary",onClick:()=>c(r=>Math.min(u,r+1)),disabled:i>=u,children:"NEXT >"})]})]})]})};export{J as default};
